2025-02-25 15:06:07,047 - root - INFO - Ejecutando análisis SHAP con los siguientes parámetros:
2025-02-25 15:06:07,047 - root - INFO - - Archivo Excel: /home/dsg/VORTEX_FINAL/PRODUCTION/DATA/processed/training_data.xlsx
2025-02-25 15:06:07,047 - root - INFO - - Directorio de salida: /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap
2025-02-25 15:06:07,048 - root - INFO - - Hojas a procesar: ['aliste', 'can_tintorer', 'encinasola']
2025-02-25 15:06:07,048 - root - INFO - - Formato de imágenes: png
2025-02-25 15:06:07,048 - root - INFO - - Resolución (DPI): 300
2025-02-25 15:06:07,048 - __main__ - INFO - Directorio de resultados configurado en: /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap
2025-02-25 15:06:07,048 - __main__ - INFO - Los gráficos se guardarán en: /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap/plots
2025-02-25 15:06:07,048 - __main__ - INFO - Las tablas se guardarán en: /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap/tables
2025-02-25 15:06:07,049 - __main__ - INFO - Analizando valores SHAP para múltiples hojas en /home/dsg/VORTEX_FINAL/PRODUCTION/DATA/processed/training_data.xlsx
2025-02-25 15:06:07,049 - __main__ - INFO - Procesando hoja: aliste
2025-02-25 15:06:07,049 - __main__ - INFO - Procesando hoja: aliste
2025-02-25 15:06:08,629 - __main__ - INFO - Datos cargados. Forma: (2256, 47)
2025-02-25 15:06:08,632 - __main__ - INFO - Distribución del objetivo antes de SMOTE:
target_PDLC
0    1504
1     752
Name: count, dtype: int64
2025-02-25 15:06:08,707 - __main__ - INFO - Distribución del objetivo después de SMOTE:
target_PDLC
1    1504
0    1504
Name: count, dtype: int64
2025-02-25 15:06:08,711 - __main__ - INFO - Entrenando nuevo modelo Random Forest...
2025-02-25 15:06:09,734 - __main__ - INFO - Evaluación del modelo:
              precision    recall  f1-score   support

           0       0.99      0.98      0.99       301
           1       0.98      0.99      0.99       301

    accuracy                           0.99       602
   macro avg       0.99      0.99      0.99       602
weighted avg       0.99      0.99      0.99       602

2025-02-25 15:06:09,963 - __main__ - INFO - Top 10 características según importancia del modelo:
   feature  importance
19      As    0.210431
27      Mo    0.094741
9        V    0.089447
37      Ta    0.083113
6       Ca    0.081861
10      Cr    0.069616
36      Ba    0.051442
5        K    0.024791
23      Sr    0.021265
16      Zn    0.020861
2025-02-25 15:06:09,963 - __main__ - INFO - Calculando valores SHAP...
2025-02-25 15:06:18,827 - __main__ - INFO - Valores SHAP en formato lista con 2 elementos
2025-02-25 15:06:18,827 - __main__ - INFO - Usando valores SHAP para clase positiva, forma: (2406, 44)
2025-02-25 15:06:18,827 - __main__ - INFO - Generando visualización SHAP...
2025-02-25 15:06:21,826 - __main__ - INFO - Gráfico guardado en: /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap/plots/SHAP_local_aliste.png
2025-02-25 15:06:21,849 - __main__ - INFO - Tabla de importancia guardada en: /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap/tables/shap_importance_aliste.csv
2025-02-25 15:06:21,857 - __main__ - INFO - Top 14 características según SHAP:
   feature  importance
19      As    0.128790
9        V    0.061331
27      Mo    0.061090
6       Ca    0.055882
37      Ta    0.054574
10      Cr    0.048777
36      Ba    0.035736
5        K    0.018615
23      Sr    0.014884
25      Zr    0.012738
2        P    0.011370
16      Zn    0.011208
33      Sn    0.010878
3        S    0.009828
2025-02-25 15:06:21,858 - __main__ - INFO - Completado procesamiento de aliste
2025-02-25 15:06:21,858 - __main__ - INFO - Procesando hoja: can_tintorer
2025-02-25 15:06:21,858 - __main__ - INFO - Procesando hoja: can_tintorer
2025-02-25 15:06:23,364 - __main__ - INFO - Datos cargados. Forma: (2256, 47)
2025-02-25 15:06:23,367 - __main__ - INFO - Distribución del objetivo antes de SMOTE:
target_CT
0    1504
1     752
Name: count, dtype: int64
2025-02-25 15:06:23,387 - __main__ - INFO - Distribución del objetivo después de SMOTE:
target_CT
0    1504
1    1504
Name: count, dtype: int64
2025-02-25 15:06:23,393 - __main__ - INFO - Entrenando nuevo modelo Random Forest...
2025-02-25 15:06:24,356 - __main__ - INFO - Evaluación del modelo:
              precision    recall  f1-score   support

           0       0.99      1.00      1.00       301
           1       1.00      0.99      1.00       301

    accuracy                           1.00       602
   macro avg       1.00      1.00      1.00       602
weighted avg       1.00      1.00      1.00       602

2025-02-25 15:06:24,447 - __main__ - INFO - Top 10 características según importancia del modelo:
   feature  importance
6       Ca    0.339588
36      Ba    0.136531
23      Sr    0.106231
15      Cu    0.051614
10      Cr    0.032724
19      As    0.031603
8       Ti    0.029445
16      Zn    0.022805
4       Cl    0.019789
5        K    0.019048
2025-02-25 15:06:24,447 - __main__ - INFO - Calculando valores SHAP...
2025-02-25 15:06:30,012 - __main__ - INFO - Valores SHAP en formato lista con 2 elementos
2025-02-25 15:06:30,012 - __main__ - INFO - Usando valores SHAP para clase positiva, forma: (2406, 44)
2025-02-25 15:06:30,012 - __main__ - INFO - Generando visualización SHAP...
2025-02-25 15:06:32,705 - __main__ - INFO - Gráfico guardado en: /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap/plots/SHAP_local_can_tintorer.png
2025-02-25 15:06:32,727 - __main__ - INFO - Tabla de importancia guardada en: /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap/tables/shap_importance_can_tintorer.csv
2025-02-25 15:06:32,734 - __main__ - INFO - Top 14 características según SHAP:
   feature  importance
6       Ca    0.199358
36      Ba    0.079183
23      Sr    0.060536
15      Cu    0.031290
19      As    0.023219
10      Cr    0.020483
8       Ti    0.017370
4       Cl    0.014957
16      Zn    0.014123
5        K    0.013596
34      Sb    0.011687
25      Zr    0.009158
2        P    0.007856
33      Sn    0.007475
2025-02-25 15:06:32,735 - __main__ - INFO - Completado procesamiento de can_tintorer
2025-02-25 15:06:32,735 - __main__ - INFO - Procesando hoja: encinasola
2025-02-25 15:06:32,735 - __main__ - INFO - Procesando hoja: encinasola
2025-02-25 15:06:34,273 - __main__ - INFO - Datos cargados. Forma: (2256, 47)
2025-02-25 15:06:34,276 - __main__ - INFO - Distribución del objetivo antes de SMOTE:
target_PCM
0    1504
1     752
Name: count, dtype: int64
2025-02-25 15:06:34,294 - __main__ - INFO - Distribución del objetivo después de SMOTE:
target_PCM
0    1504
1    1504
Name: count, dtype: int64
2025-02-25 15:06:34,299 - __main__ - INFO - Entrenando nuevo modelo Random Forest...
2025-02-25 15:06:35,293 - __main__ - INFO - Evaluación del modelo:
              precision    recall  f1-score   support

           0       0.99      0.99      0.99       301
           1       0.99      0.99      0.99       301

    accuracy                           0.99       602
   macro avg       0.99      0.99      0.99       602
weighted avg       0.99      0.99      0.99       602

2025-02-25 15:06:35,368 - __main__ - INFO - Top 10 características según importancia del modelo:
   feature  importance
6       Ca    0.145126
19      As    0.137731
9        V    0.102970
5        K    0.064296
37      Ta    0.059730
27      Mo    0.046553
15      Cu    0.042635
36      Ba    0.039657
10      Cr    0.035307
3        S    0.034593
2025-02-25 15:06:35,368 - __main__ - INFO - Calculando valores SHAP...
2025-02-25 15:06:44,710 - __main__ - INFO - Valores SHAP en formato lista con 2 elementos
2025-02-25 15:06:44,711 - __main__ - INFO - Usando valores SHAP para clase positiva, forma: (2406, 44)
2025-02-25 15:06:44,711 - __main__ - INFO - Generando visualización SHAP...
2025-02-25 15:06:47,419 - __main__ - INFO - Gráfico guardado en: /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap/plots/SHAP_local_encinasola.png
2025-02-25 15:06:47,441 - __main__ - INFO - Tabla de importancia guardada en: /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap/tables/shap_importance_encinasola.csv
2025-02-25 15:06:47,447 - __main__ - INFO - Top 14 características según SHAP:
   feature  importance
6       Ca    0.106372
19      As    0.084921
9        V    0.074617
5        K    0.056029
37      Ta    0.043341
15      Cu    0.030931
20      Se    0.030728
27      Mo    0.027360
3        S    0.023889
36      Ba    0.023323
8       Ti    0.016515
10      Cr    0.016398
23      Sr    0.014440
12      Fe    0.010444
2025-02-25 15:06:47,448 - __main__ - INFO - Completado procesamiento de encinasola
2025-02-25 15:06:47,448 - __main__ - INFO - Generando tabla de importancia combinada...
2025-02-25 15:06:47,458 - __main__ - INFO - Tabla de importancia combinada guardada en: /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap/tables/shap_importance_combined.csv
2025-02-25 15:06:47,472 - __main__ - INFO - Top 10 características promedio:
   feature  aliste_importance  can_tintorer_importance  encinasola_importance  avg_importance
3       Ca           0.055882                 0.199358               0.106372        0.120537
0       As           0.128790                 0.023219               0.084921        0.078977
1        V           0.061331                 0.004831               0.074617        0.046926
6       Ba           0.035736                 0.079183               0.023323        0.046081
4       Ta           0.054574                 0.001997               0.043341        0.033304
2       Mo           0.061090                 0.006952               0.027360        0.031801
8       Sr           0.014884                 0.060536               0.014440        0.029953
7        K           0.018615                 0.013596               0.056029        0.029413
5       Cr           0.048777                 0.020483               0.016398        0.028553
18      Cu           0.006211                 0.031290               0.030931        0.022811
2025-02-25 15:06:47,472 - __main__ - INFO - Resumen del procesamiento:
2025-02-25 15:06:47,472 - __main__ - INFO - - Hojas procesadas correctamente: 3
2025-02-25 15:06:47,472 - __main__ - INFO - - Hojas con errores: 0
2025-02-25 15:06:47,472 - __main__ - INFO - - Total de hojas: 3
2025-02-25 15:06:47,473 - root - INFO - Proceso completado con éxito. Resultados guardados en /home/dsg/VORTEX_FINAL/PRODUCTION/resultados_shap
